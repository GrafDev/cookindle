# CLAUDE.md

Этот файл предоставляет руководство для Claude Code (claude.ai/code) при работе с кодом в этом репозитории.

## Правила работы

- **Язык общения**: русский
- **Процесс**: сначала обсуждение, код только после команды
- **Решения**: только рабочие варианты без лишнего
- **Контекст**: всегда учитывать существующий код
- **Среда разработки**: VSCode, Kubuntu, терминал zsh, используй PixiJS
- **Вопросы**: если в запросе есть в начале "..", то надо просто отвечать на вопрос, или комментировать, без написания кода

## Роль

Ты выступаешь как Senior frontend разработчик.

## Обзор проекта

**Cookindle** - это интерактивная игра-головоломка на основе PixiJS, где игрок разрушает печенье в виде шестиугольника, удаляя кусочки кликами иглы. Цель: убрать все кусочки кроме центральной фигуры, не кликая внутри неё.

### Игровая механика
- **Победа**: удалить все кусочки кроме центральной формы (круг/квадрат/треугольник)
- **Поражение**: клик внутри центральной формы вызывает Game Over
- **Физика**: кусочки падают и увлекают за собой соседние при отрыве
- **Анимации**: двухволновое разрушение при fail (сначала центр, потом остальные)

## Команды разработки

```bash
# Запуск сервера разработки
npx vite

# Сборка для продакшена
npx vite build

# Предварительный просмотр продакшен сборки
npx vite preview
```

## Структура проекта

### Основные файлы
- `src/main.js` - **Главный файл игры** (весь игровой код, 3500+ строк)
- `src/config.js` - **Конфигурация игры** (параметры форм, анимаций, физики)
- `src/app.js` - Вспомогательный файл (пустой)
- `index.html` - HTML страница

### Ресурсы
- `src/assets/textures/` - Игровые текстуры:
  - `bg.png`, `bg_cooke.png` - фоны
  - `circle.png`, `square.png`, `triangle.png` - формы
  - `needle.png`, `needle_shadow.png` - игла и тень
- `src/assets/svg/` - SVG иконки
- `src/styles/` - CSS стили (base, reset, dev, main)

### Утилиты
- `src/utils/` - Модули утилит (debug, loader, resize) - пока пустые

## Основные зависимости

- **PixiJS (v8.11.0)** - Графический движок для рендеринга
- **Vite (v7.0.3)** - Инструмент сборки и сервер разработки

## Архитектура игры

### Ключевые системы

#### 1. **HexGrid система**
- Основа: шестиугольная сетка с параметром `CONFIG.cookie.pieces.hexGrid` (31)
- Типы кусочков: обычные, краевые, центральные, краевые центральные
- Формула размера: `bigHexDiameter = hexGrid * (smallHexRadius * √3)`

#### 2. **Центральные формы** 
- 3 типа: круг (1), квадрат (2), треугольник (3)
- Настройка: `CONFIG.centerShape.form`
- Пульсирующая анимация обводки
- Безопасная зона для кликов только по краям

#### 3. **Мобильная поддержка**
- Автоопределение: `isMobile` через user agent и touch API
- Статическая позиция иглы справа экрана
- Touch события: touchstart, touchmove, touchend
- Анимация перемещения иглы к точке касания

#### 4. **Система анимаций** (без внешних библиотек)
- `animateHexagonFall()` - падение кусочков с физикой
- `animateFullCookieCrumble()` - двухволновое разрушение при fail
- `animateNeedlePress()` - анимация нажатия иглы
- Использует requestAnimationFrame и setTimeout

#### 5. **Модальные окна**
- **Congratulations**: победа, кнопка "Play Again"
- **Game Over**: поражение, перезапуск через `restartGame()`
- Флаги `victoryShown`, `gameOverShown` предотвращают повторы

### Основные функции в main.js

#### Инициализация
- `initApp()` - создание PixiJS приложения
- `loadAssets()` - загрузка текстур
- `initGame()` - создание игровых объектов

#### Игровая логика
- `generateSmallHexagons()` - создание шестиугольной сетки
- `handleNeedlePaintingAtPoint()` - обработка кликов иглой
- `checkVictoryCondition()` - проверка условий победы
- `findHexagonAtPoint()` - поиск кусочка по координатам

#### Управление состоянием
- `changeShape(newShapeId)` - смена формы с `restartGame()`
- `changeHexGrid(newHexGrid)` - смена количества кусочков с `restartGame()`
- `restartGame()` - полный перезапуск без перезагрузки страницы

#### Интерактивность
- `setupInteractivity()` - настройка mouse/touch событий
- `updateNeedlePosition()` - позиционирование иглы
- Разные обработчики для десктопа и мобильных

### Важные особенности

#### Технические кнопки
- Показываются при `CONFIG.dev.showShapeButtons: true`
- Смена формы центральной области
- Изменение количества кусочков (hexGrid ±5, диапазон 15-65)

#### Отладка
- Консольные логи в dev режиме (`isDev`)
- Визуальная отладка для мобильных касаний
- Цветовая дифференциация типов кусочков

#### Производительность
- Один главный файл для простоты
- Эффективная работа с PixiJS объектами
- Оптимизированные анимации

## Git workflow

- **main** - основная ветка
- **feature/*** - ветки для новых функций
- Текущая ветка: `feature/png-texture-shapes` для экспериментов с PNG формами

## Заметки для разработки

1. **Весь игровой код в main.js** - не разбивать на модули без необходимости
2. **Конфигурация в config.js** - все параметры централизованы
3. **Мобильная совместимость** - учитывать touch события и размеры экрана
4. **Анимации без библиотек** - использовать requestAnimationFrame
5. **Осторожно с restartGame()** - функция полностью пересоздает игру